<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating Training Data from Existing Annotations &mdash; Local Automatic Text Recognition with Loghi 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_lesson.css?v=0c089442" />
      <link rel="stylesheet" type="text/css" href="_static/term_role_formatting.css?v=4194e21c" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />
      <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=a5c4661c" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=2709fde1"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script src="_static/minipres.js?v=a0d29692"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Fine-Tuning a Small Custom Model" href="05_finetune_model.html" />
    <link rel="prev" title="Using a Pre-Trained Model to Recognise Text" href="03_pre-trained_model.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Local Automatic Text Recognition with Loghi
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="00_intro.html">General Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_loghi_docker_setup.html">Setting Up Loghi with Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_pre-trained_model.html">Using a Pre-Trained Model to Recognise Text</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating Training Data from Existing Annotations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#modifying-create-train-data-sh">Modifying <code class="docutils literal notranslate"><span class="pre">create-train-data.sh</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-create-train-data-sh">Running <code class="docutils literal notranslate"><span class="pre">create-train-data.sh</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#inspecting-the-reformatted-data">Inspecting the Reformatted Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="05_finetune_model.html">Fine-Tuning a Small Custom Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Material</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="material_shell.html">Unix Shell Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Local Automatic Text Recognition with Loghi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Creating Training Data from Existing Annotations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/04_create_train_data.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-training-data-from-existing-annotations">
<h1>Creating Training Data from Existing Annotations<a class="headerlink" href="#creating-training-data-from-existing-annotations" title="Link to this heading"></a></h1>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<p>Learn how to reformat an existing, annotated dataset, so that it can be used for training/fine-tuning Loghi models.</p>
</div>
<div class="admonition-prerequisites prerequisites admonition" id="prerequisites-0">
<p class="admonition-title">Prerequisites</p>
<ul class="simple">
<li><p>images and corresponding annotations in PAGE XML</p></li>
<li><p>the script <code class="docutils literal notranslate"><span class="pre">create-train-data.sh</span></code></p></li>
</ul>
</div>
<p>During training, Loghi expects that the data is arranged in a specific format. The <code class="docutils literal notranslate"><span class="pre">create-train-data.sh</span></code> script will convert a dataset with the structure</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>finetune
├──<span class="w"> </span>no-nb_digimanus_300599_0003.jpg
├──<span class="w"> </span>no-nb_digimanus_300599_0004.jpg
├──<span class="w"> </span>no-nb_digimanus_300599_0005.jpg
├──<span class="w"> </span>...
└──<span class="w"> </span>page
<span class="w">    </span>├──<span class="w"> </span>no-nb_digimanus_300599_0003.xml
<span class="w">    </span>├──<span class="w"> </span>no-nb_digimanus_300599_0004.xml
<span class="w">    </span>├──<span class="w"> </span>no-nb_digimanus_300599_0005.xml
<span class="w">    </span>├──<span class="w"> </span>...
</pre></div>
</div>
<p>to the desired structure, outlined in detail further below.</p>
<p>Note that this step is only necessary for training data. If you already have a trained model and want to use it to recognise unseen datasets, you will only need images of the individual pages, as described in the previous page.</p>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<p>If you are using the provided material to follow this lesson, use the images in the Bonnevie <code class="docutils literal notranslate"><span class="pre">finetune</span></code> directory, so that these can be used in the next step to fine-tune a model on her handwriting.</p>
</div>
<section id="modifying-create-train-data-sh">
<h2>Modifying <code class="docutils literal notranslate"><span class="pre">create-train-data.sh</span></code><a class="headerlink" href="#modifying-create-train-data-sh" title="Link to this heading"></a></h2>
<p>You will only have to modify <code class="docutils literal notranslate"><span class="pre">create-train-data.sh</span></code> in case you want to change one of the following settings, otherwise you can leave it as-is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">trainsplit=90</span></code> – indicates the percentage (here 90%) that should be used as training set. The rest (here 10%) is used as validation set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include_text_styles=1</span></code> – set to 0 if you <strong>don’t</strong> want text styles to be included in the output</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skip_unclear=1</span></code> – set to 0 if you <strong>don’t</strong> want to skip text regions marked as unclear</p></li>
</ul>
</section>
<section id="running-create-train-data-sh">
<h2>Running <code class="docutils literal notranslate"><span class="pre">create-train-data.sh</span></code><a class="headerlink" href="#running-create-train-data-sh" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p>In your shell, navigate to the location of <code class="docutils literal notranslate"><span class="pre">create-train-data.sh</span></code></p></li>
<li><p>Execute the script by running <code class="docutils literal notranslate"><span class="pre">./create-train-data.sh</span> <span class="pre">INPUT_PATH</span> <span class="pre">OUTPUT_PATH</span></code>, where <code class="docutils literal notranslate"><span class="pre">INPUT_PATH</span></code> is the path to your image directory, and <code class="docutils literal notranslate"><span class="pre">OUTPUT_PATH</span></code> is the path, the reformatted dataset should be written to, e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./create-train-data.sh<span class="w"> </span>/home/demo/loghi_material/bonnevie_images/finetune<span class="w"> </span>/home/demo/loghi_material/finetune_data
</pre></div>
</div>
<ul class="simple">
<li><p>if your system reports <code class="docutils literal notranslate"><span class="pre">permission</span> <span class="pre">denied:</span> <span class="pre">./create-train-data.sh</span></code>, run <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">755</span> <span class="pre">create-train-data.sh</span></code> to make the script executable, and try running it again</p></li>
</ul>
</li>
</ol>
</section>
<section id="inspecting-the-reformatted-data">
<h2>Inspecting the Reformatted Data<a class="headerlink" href="#inspecting-the-reformatted-data" title="Link to this heading"></a></h2>
<p>You should end up with a structure similar to the one below, with the filenames adapted to your dataset of choice.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>finetune_data
<span class="linenos"> 2</span>├──<span class="w"> </span>no-nb_digimanus_300599_0003
<span class="linenos"> 3</span>│<span class="w">   </span>├──<span class="w"> </span>no-nb_digimanus_300599_0003-line_1603435838929_122.box
<span class="linenos"> 4</span>│<span class="w">   </span>├──<span class="w"> </span>no-nb_digimanus_300599_0003-line_1603435838929_122.png
<span class="linenos"> 5</span>│<span class="w">   </span>├──<span class="w"> </span>no-nb_digimanus_300599_0003-line_1603435838929_122.txt
<span class="linenos"> 6</span>│<span class="w">   </span>├──<span class="w"> </span>no-nb_digimanus_300599_0003-r1l10.box
<span class="linenos"> 7</span>│<span class="w">   </span>├──<span class="w"> </span>no-nb_digimanus_300599_0003-r1l10.png
<span class="linenos"> 8</span>│<span class="w">   </span>├──<span class="w"> </span>no-nb_digimanus_300599_0003-r1l10.txt
<span class="linenos"> 9</span>│<span class="w">   </span>├──<span class="w"> </span>...
<span class="linenos">10</span>├──<span class="w"> </span>no-nb_digimanus_300599_0004
<span class="linenos">11</span>│<span class="w">   </span>├──<span class="w"> </span>...
<span class="linenos">12</span>├──<span class="w"> </span>...
<span class="linenos">13</span>├──<span class="w"> </span>training_all.txt
<span class="linenos">14</span>├──<span class="w"> </span>training_all_train.txt
<span class="linenos">15</span>└──<span class="w"> </span>training_all_val.txt
</pre></div>
</div>
<p>Loghi has processed each of the original page images and has extracted the individual text lines, as defined in the PAGE XML. One directory has been created per document image (lines 2 and 10), with three files per text line within:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">LINENAME.png</span></code> – image of the segmented line, extracted using a polygonal bounding box (if provided in the PAGE XML)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LINENAME.txt</span></code> – contains the line’s transcription in plain text</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LINENAME.box</span></code> – a <a class="reference external" href="https://tesseract-ocr.github.io/">Tesseract</a> box file, describing the text line in the format: <code class="docutils literal notranslate"><span class="pre">&lt;symbol&gt;</span> <span class="pre">&lt;left&gt;</span> <span class="pre">&lt;bottom&gt;</span> <span class="pre">&lt;right&gt;</span> <span class="pre">&lt;top&gt;</span> <span class="pre">&lt;page&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;symbol&gt;</span></code> lists the characters in the transcription, one per line, <code class="docutils literal notranslate"><span class="pre">&lt;left&gt;</span> <span class="pre">&lt;bottom&gt;</span> <span class="pre">&lt;right&gt;</span> <span class="pre">&lt;top&gt;</span></code> are the bounding box coordinates of either the glyph or the whole line, and <code class="docutils literal notranslate"><span class="pre">&lt;page&gt;</span></code> indicates the index in the case of multi-page TIFF images, or <code class="docutils literal notranslate"><span class="pre">0</span></code> for other image types (e.g. JPGs).</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Box file example for a line with the bottom left corner at <code class="docutils literal notranslate"><span class="pre">x=0,</span> <span class="pre">y=0</span></code>, and the top right corner at <code class="docutils literal notranslate"><span class="pre">x=3230,</span> <span class="pre">y=162</span></code>, first three letters in the transcription are <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">e</span></code>, <code class="docutils literal notranslate"><span class="pre">l</span></code></span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3230</span> <span class="mi">162</span> <span class="mi">0</span>
<span class="n">e</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3230</span> <span class="mi">162</span> <span class="mi">0</span>
<span class="n">l</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3230</span> <span class="mi">162</span> <span class="mi">0</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</li>
</ul>
<p>Besides the line-level data, Loghi has also created the following three index files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">training_all.txt</span></code> – paths to <strong>all</strong> of the extracted line images, with corresponding transcriptions, tab-separated</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">training_all_train.txt</span></code> – the portion of all text lines that is designated as <strong>training</strong> set</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">training_all_val.txt</span></code> – the portion of all text lines that is designated as <strong>valiation</strong> set</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The training and validation sets do not overlap, i.e. a given text line is <strong>either</strong> in the training <strong>or</strong> in the validation set!</p>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Excerpt from an index file</span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="n">loghi_material</span><span class="o">/</span><span class="n">finetune_data</span><span class="o">/</span><span class="n">no</span><span class="o">-</span><span class="n">nb_digimanus_300599_0004</span><span class="o">/</span><span class="n">no</span><span class="o">-</span><span class="n">nb_digimanus_300599_0004</span><span class="o">-</span><span class="n">r1l22</span><span class="o">.</span><span class="n">png</span>	<span class="n">i</span> <span class="n">den</span> <span class="n">ene</span> <span class="n">eller</span> <span class="n">anden</span> <span class="n">retning</span> <span class="n">med</span> <span class="n">Karls</span> <span class="n">tilstand</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="n">loghi_material</span><span class="o">/</span><span class="n">finetune_data</span><span class="o">/</span><span class="n">no</span><span class="o">-</span><span class="n">nb_digimanus_300599_0004</span><span class="o">/</span><span class="n">no</span><span class="o">-</span><span class="n">nb_digimanus_300599_0004</span><span class="o">-</span><span class="n">r1l19</span><span class="o">.</span><span class="n">png</span>	<span class="n">liker</span> <span class="n">det</span><span class="o">.</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="03_pre-trained_model.html" class="btn btn-neutral float-left" title="Using a Pre-Trained Model to Recognise Text" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="05_finetune_model.html" class="btn btn-neutral float-right" title="Fine-Tuning a Small Custom Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Raphaela Heil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>